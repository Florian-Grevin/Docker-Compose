<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title> Messages </title>
    <style>
        body { font-family: monospace; background: #222; color: #0f0; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        input, button { padding: 10px; width: 100%; margin-bottom: 10px; border: 1px solid #0f0; background: #000; color: #0f0; }
        button { cursor: pointer; font-weight: bold; }
        .message-box { border: 1px dashed #444; padding: 10px; margin-top: 10px; background: #111; }
        .warning { color: red; font-weight: bold; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <p class="warning">ATTENTION : Ce site est vulnérable au XSS !</p>

    <input type="text" id="msgInput" placeholder="Écrivez votre message ici...">
    <button onclick="postMessage()">Envoyer au serveur</button>

    <div id="feed"></div>
</div>

<script>
    const API_URL = 'http://localhost:4000/messages';

    async function postMessage() {
        const content = document.getElementById('msgInput').value;
        
        await fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ content })
        });
        
        document.getElementById('msgInput').value = '';
        loadMessages();
    }

    async function loadMessages() {
        const res = await fetch(API_URL);
        const messages = await res.json();
        
        const feed = document.getElementById('feed');
        feed.innerHTML = ''; 

        messages.reverse().forEach(msg => {
            const div = document.createElement('div');
            div.className = 'message-box';
            
            div.innerHTML = `Date: ${new Date(msg.date).toLocaleTimeString()}<br>Message: ${msg.content}`;
            
            feed.appendChild(div);
        });
    }

    loadMessages();
</script>

</body>
</html>